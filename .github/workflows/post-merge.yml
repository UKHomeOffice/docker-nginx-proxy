name: Post Merge

on:
  push:
    branches:
      - master

permissions:
  contents: read

concurrency: nginx-proxy-post-merge

jobs:
  image-tests:
    name: Run Docker Image Tests
    uses: ./.github/workflows/run-tests.yml

  unit-tests:
    name: Run Unit Tests
    uses: alphagov/pay-ci/.github/workflows/_run-node-unit-tests.yml@master
    with:
      node_version: "12.22.10"
      test_runner_flags: "--forbid-only --forbid-pending"

  tag-release:
    name: Tag Release
    needs:
      - image-tests
      - unit-tests
    permissions:
      contents: write
    uses: alphagov/pay-ci/.github/workflows/_create-alpha-release-tag.yml@master